# 公网部署指南

## 1. 服务器准备

### 1.1 选择云服务器
- 推荐使用阿里云、腾讯云、AWS、Google Cloud等主流云服务商
- 最低配置建议：2核4G内存，40G硬盘
- 操作系统：Ubuntu 20.04 或 CentOS 7+

### 1.2 服务器初始化
- 登录服务器（使用SSH）
- 更新系统包：
  ```bash
  # Ubuntu
  sudo apt update && sudo apt upgrade -y
  
  # CentOS
  sudo yum update -y
  ```
- 安装必要的工具：
  ```bash
  # Ubuntu
  sudo apt install -y git curl wget 
  
  # CentOS
  sudo yum install -y git curl wget
  ```

## 2. 安装Docker和Docker Compose

### 2.1 安装Docker
```bash
# Ubuntu
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# CentOS
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install -y docker-ce docker-ce-cli containerd.io
```

### 2.2 安装Docker Compose
```bash
# Ubuntu & CentOS
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### 2.3 启动Docker服务
```bash
sudo systemctl start docker
sudo systemctl enable docker
```

## 3. 域名配置

### 3.1 注册域名
- 在阿里云、腾讯云、GoDaddy等域名服务商注册域名
- 例如：`example.com`

### 3.2 域名解析
- 登录域名管理控制台
- 添加A记录，将域名指向服务器的公网IP
- 记录类型：A
- 主机记录：`@`（或www，根据需求）
- 记录值：服务器公网IP
- TTL：默认即可

## 4. 部署项目

### 4.1 克隆代码
```bash
git clone <项目仓库地址>
cd new_year_wish_exchange
```

### 4.2 配置环境变量
- 后端支持通过环境变量配置
- 可创建`.env`文件（可选）：
  ```bash
  # backend/.env
  PORT=3000
  JWT_SECRET=your-secret-key-change-this-in-production
  NODE_ENV=production
  ```

### 4.3 构建并启动容器
```bash
docker-compose build
docker-compose up -d
```

## 5. SSL证书配置（可选但推荐）

### 5.1 使用Let's Encrypt免费证书
- 安装Certbot：
  ```bash
  # Ubuntu
  sudo apt install -y certbot python3-certbot-nginx
  
  # CentOS
  sudo yum install -y epel-release
sudo yum install -y certbot python3-certbot-nginx
  ```

- 申请证书：
  ```bash
sudo certbot --nginx -d example.com -d www.example.com
  ```

### 5.2 配置Nginx使用SSL
- 编辑前端的`nginx.conf`文件，取消注释HTTPS配置部分
- 修改`server_name`为你的域名
- 修改SSL证书路径为实际路径
- 重新构建并启动容器：
  ```bash
docker-compose build
docker-compose up -d
  ```

## 6. 防火墙配置

### 6.1 开放必要端口
- 80端口（HTTP）
- 443端口（HTTPS，如需）

```bash
# Ubuntu (ufw)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# CentOS (firewalld)
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --reload
```

## 7. 访问项目

### 7.1 HTTP访问
- 浏览器访问：`http://your-domain.com`

### 7.2 HTTPS访问（如配置）
- 浏览器访问：`https://your-domain.com`

### 7.3 管理员后台
- 访问：`http://your-domain.com/admin`（或HTTPS）
- 默认管理员账号：`admin`
- 默认密码：`betterway614`（建议登录后修改）

## 8. 维护与监控

### 8.1 查看日志
```bash
docker-compose logs -f
```

### 8.2 重启服务
```bash
docker-compose restart
```

### 8.3 更新代码
```bash
git pull
docker-compose build
docker-compose up -d
```

## 9. 安全建议

1. 定期更新系统和Docker镜像
2. 修改默认管理员密码
3. 使用HTTPS加密通信
4. 配置适当的防火墙规则
5. 定期备份数据库文件
6. 考虑使用CDN加速静态资源

## 10. 常见问题

### 10.1 无法访问项目
- 检查服务器公网IP是否正确
- 检查域名解析是否生效
- 检查防火墙是否开放了80/443端口
- 检查Docker容器是否正常运行

### 10.2 HTTPS配置问题
- 确保SSL证书路径正确
- 确保域名与证书匹配
- 检查Nginx配置是否正确

### 10.3 数据库问题
- 数据库文件存储在`data`目录下，建议定期备份
- 如需要清空数据库，可使用后端提供的`clearDatabase`函数

## 11. 技术支持

- 查看项目文档
- 检查日志文件
- 联系项目开发团队
